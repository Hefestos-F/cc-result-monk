<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Declaração de Embarque</title>
    <style>
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;padding:20px;max-width:900px;margin:auto;color:#111}
      label{display:block;margin-top:12px;font-weight:600}
      input, textarea, select{padding:8px;border:1px solid #ccc;border-radius:6px;margin-top:6px}
      .row{display:flex;gap:12px}
      .row > *{flex:1}
      .actions{margin-top:18px;display:flex;gap:8px}
      button{padding:8px 12px;border-radius:6px;border:0;background:#0366d6;color:white;cursor:pointer}
      button.ghost{background:#eee;color:#111}
      pre#preview{white-space:pre-wrap;background:#f7f9fc;border:1px solid #e1e4ea;padding:16px;border-radius:6px;margin-top:12px}
      .muted{color:#555;font-size:0.9rem}
    </style>
  </head>
  <body>
    <h1>Declaração de Embarque</h1>
    <p class="muted">
      Preencha os campos abaixo e clique em "Gerar Declaração" para criar o
      texto formatado.
    </p>
    <div class="row">
      <label for="cidade">Cidade da declaração</label>
      <input id="cidade" value="São Paulo" readonly />
      <label for="declaracao_date">Data da declaração</label>
      <input
        id="declaracao_date"
        type="date"
        aria-label="data da declaracao"
        readonly
      />

      <label for="companhia">Companhia aérea</label>
      <input id="companhia" value="GOL Linhas Aéreas S.A" readonly disabled />
    </div>
    <div class="row">
      <label for="nome">Nome do(a) passageiro(a)</label>
      <input id="nome" value="-" />

      <label for="localizador">Código localizador</label>
      <input id="localizador" value="-" />
    </div>
    <div class="row">
      <label for="origem">Origem</label>
      <select id="origem">
        <option value="-">-</option>
        <option value="Belém (BEL)">Belém (BEL)</option>
        <option value="Belo Horizonte - Confins (CNF)">
          Belo Horizonte - Confins (CNF)
        </option>
        <option value="Brasília (BSB)">Brasília (BSB)</option>
        <option value="Curitiba (CWB)">Curitiba (CWB)</option>
        <option value="Florianópolis (FLN)">Florianópolis (FLN)</option>
        <option value="Fortaleza (FOR)">Fortaleza (FOR)</option>
        <option value="Manaus (MAO)">Manaus (MAO)</option>
        <option value="Porto Alegre (POA)">Porto Alegre (POA)</option>
        <option value="Recife (REC)">Recife (REC)</option>
        <option value="Rio de Janeiro - Galeão (GIG)">
          Rio de Janeiro - Galeão (GIG)
        </option>
        <option value="Rio de Janeiro - Santos Dumont (SDU)">
          Rio de Janeiro - Santos Dumont (SDU)
        </option>
        <option value="Salvador (SSA)">Salvador (SSA)</option>
        <option value="São Paulo - Congonhas (CGH)">
          São Paulo - Congonhas (CGH)
        </option>
        <option value="São Paulo - Guarulhos (GRU)">
          São Paulo - Guarulhos (GRU)
        </option>
      </select>

      <label for="destino">Destino</label>
      <select id="destino">
        <option value="-">-</option>
        <option value="Belém (BEL)">Belém (BEL)</option>
        <option value="Belo Horizonte - Confins (CNF)">
          Belo Horizonte - Confins (CNF)
        </option>
        <option value="Brasília (BSB)">Brasília (BSB)</option>
        <option value="Curitiba (CWB)">Curitiba (CWB)</option>
        <option value="Florianópolis (FLN)">Florianópolis (FLN)</option>
        <option value="Fortaleza (FOR)">Fortaleza (FOR)</option>
        <option value="Manaus (MAO)">Manaus (MAO)</option>
        <option value="Porto Alegre (POA)">Porto Alegre (POA)</option>
        <option value="Recife (REC)">Recife (REC)</option>
        <option value="Rio de Janeiro - Galeão (GIG)">
          Rio de Janeiro - Galeão (GIG)
        </option>
        <option value="Rio de Janeiro - Santos Dumont (SDU)">
          Rio de Janeiro - Santos Dumont (SDU)
        </option>
        <option value="Salvador (SSA)">Salvador (SSA)</option>
        <option value="São Paulo - Congonhas (CGH)">
          São Paulo - Congonhas (CGH)
        </option>
        <option value="São Paulo - Guarulhos (GRU)">
          São Paulo - Guarulhos (GRU)
        </option>
      </select>
    </div>
    <h3>Voo de ida</h3>
    <label>Tipo de viagem</label>
    <select id="tipo_viagem_select" onchange="marcadoida()">
      <option value="-"></option>
      <option value="ida">IDA</option>
      <option value="ida/volta">IDA/VOLTA</option>
    </select>
    <div id="CaixaDida" style="display: none;">
      <div class="row">
        <div>
          <label for="ida_data">Data (ida)</label>
          <input id="ida_data" type="date" aria-label="data ida" required />
        </div>
        <div>
          <label for="ida_num">Número do voo</label>
          <input id="ida_num" value="-" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="ida_partida_aero">Partida - aeroporto (código)</label>
          <input id="ida_partida_aero" value="-" />
        </div>
        <div>
          <label for="ida_partida_hora">Horário partida</label>
          <input id="ida_partida_hora" value="-" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="ida_chegada_aero">Chegada - aeroporto (código)</label>
          <input id="ida_chegada_aero" value="-" />
        </div>
        <div>
          <label for="ida_chegada_hora">Horário chegada</label>
          <input id="ida_chegada_hora" value="-" />
        </div>
      </div>
      <div id="ida_con_1" style="display: none;">
        <div class="row">
          <div>
            <label for="ida_num_C1">Número do voo</label>
            <input id="ida_num_C1" value="-" />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="ida_partida_aero_C1"
              >Partida - aeroporto (código)</label
            >
            <input id="ida_partida_aero_C1" value="-" />
          </div>
          <div>
            <label for="ida_partida_hora_C1">Horário partida</label>
            <input id="ida_partida_hora_C1 value="-" />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="ida_chegada_aero_C1"
              >Chegada - aeroporto (código)</label
            >
            <input id="ida_chegada_aero_C1" value="-" />
          </div>
          <div>
            <label for="ida_chegada_hora_C1">Horário chegada</label>
            <input id="ida_chegada_hora_C1" value="-" />
          </div>
        </div>
      </div>
      <label for="ida_conexoes_count">Número de conexões (ida)</label>
      <input id="ida_conexoes_count" type="number" min="0" value="0" />
      <div id="ida_conexoes_container"></div>
    </div>

    <div id="CaixaDvolta" style=" display: none;">
      <div id="volta_section">
        <h3>Voo de volta</h3>
        <label for="volta_conexoes_count">Número de conexões (volta)</label>
        <input id="volta_conexoes_count" type="number" min="0" value="0" />
        <div id="volta_conexoes_container"></div>
      </div>
      <div class="row">
        <div>
          <label for="volta_data">Data (volta)</label>
          <input id="volta_data" type="date" aria-label="data volta" required />
        </div>
        <div>
          <label for="volta_num">Número do voo</label>
          <input id="volta_num" value="-" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="volta_partida_aero">Partida - aeroporto (código)</label>
          <input id="volta_partida_aero" value="-" />
        </div>
        <div>
          <label for="volta_partida_hora">Horário partida</label>
          <input id="volta_partida_hora" value="-" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="volta_chegada_aero">Chegada - aeroporto (código)</label>
          <input id="volta_chegada_aero" value="-" />
        </div>
        <div>
          <label for="volta_chegada_hora">Horário chegada</label>
          <input id="volta_chegada_hora" value="-" />
        </div>
      </div>
    </div>

    <div class="actions">
      <button id="btn_exemplo" class="ghost">Carregar exemplo</button>
      <button id="btn_gerar">Gerar Declaração</button>
      <button id="btn_copiar" class="ghost">Copiar</button>
      <button id="btn_imprimir" class="ghost">Imprimir</button>
      <button id="btn_baixar" class="ghost">Baixar .txt</button>
    </div>

    <pre id="preview"></pre>

    <script>
      const Byid = (id) => document.getElementById(id);

      // ---- Mostrar/ocultar conexões (ida) ----
      const ida_conexoes_count = Byid("ida_conexoes_count");
      const ida_con_1 = Byid("ida_con_1");

      ida_conexoes_count.addEventListener("input", () => {
        const qtd = Number(ida_conexoes_count.value || 0);
        ida_con_1.style.display = qtd > 0 ? "block" : "none";
      });

      // ---- Mostrar/ocultar se é ida e/ou volta ----
      function marcadoida() {
        const CaixaDida = Byid("CaixaDida");
        const CaixaDvolta = Byid("CaixaDvolta");
        const tipo_viagem_select = Byid("tipo_viagem_select");

        if (
          tipo_viagem_select.value === "ida/volta" ||
          tipo_viagem_select.value === "ida"
        ) {
          CaixaDida.style.display = "block";
        } else {
          CaixaDida.style.display = "none";
        }

        if (tipo_viagem_select.value === "ida/volta") {
          CaixaDvolta.style.display = "block";
        } else {
          CaixaDvolta.style.display = "none";
        }

        atualizarIda();
      }

      // ---- Preenchimento automático do aeroporto de partida (ida) ----
      const ida_partida_aero = Byid("ida_partida_aero");
      const origem = Byid("origem"); // Certifique-se que existe no HTML

      function atualizarIda() {
        if (ida_partida_aero && origem) {
          if (ida_partida_aero.value === "-") {
            ida_partida_aero.value = origem.value || "-";
          }
        }
      }

      if (ida_partida_aero) {
        ida_partida_aero.addEventListener("input", atualizarIda);
      }

      // ---- Geração do texto somente sob demanda ----
      function textoInicial() {
        const cidadeEl = Byid("cidade");
        const dataDeclEl = Byid("declaracao_date");
        const cidade = cidadeEl ? cidadeEl.value : "";
        const dataDecl = dataDeclEl ? dataDeclEl.value : "";
        return `${cidade}, ${dataDecl}`;
      }

      function textodaida() {
        // Campos base
        const nome = Byid("nome")?.value ?? "";
        const localizador = Byid("localizador")?.value ?? "";
        const companhia = Byid("companhia")?.value ?? "";
        const ida_data = Byid("ida_data")?.value ?? "";
        const ida_num = Byid("ida_num")?.value ?? "";
        const ida_partida_aero_v = Byid("ida_partida_aero")?.value ?? "";
        const ida_partida_hora = Byid("ida_partida_hora")?.value ?? "";
        const ida_chegada_aero = Byid("ida_chegada_aero")?.value ?? "";
        const ida_chegada_hora = Byid("ida_chegada_hora")?.value ?? "";

        let texto =
          `Fazemos referência, por ora, que&nbsp;a&nbsp;Sr.(a)&nbsp;${nome}&nbsp;possuía a passagem de código ` +
          `localizador ${localizador} e embarcou com a companhia ${companhia}, sendo o voo de ` +
          `ida no dia&nbsp;${ida_data}, no voo G3&nbsp;${ida_num}, partindo do ${ida_partida_aero_v} às ${ida_partida_hora}, ` +
          `chegando em ${ida_chegada_aero} às ${ida_chegada_hora}`;

        // Conexão 1 (opcional)
        const qtdCon = Number(Byid("ida_conexoes_count")?.value || 0);
        if (qtdCon > 0) {
          const v = Byid("ida_num_C1")?.value ?? "";
          const o = Byid("ida_partida_aero_C1")?.value ?? "";
          const hs = Byid("ida_partida_hora_C1")?.value ?? "";
          const d = Byid("ida_chegada_aero_C1")?.value ?? "";
          const hc = Byid("ida_chegada_hora_C1")?.value ?? "";
          texto += `, com uma conexão no voo G3&nbsp;${v}, partindo de ${o} às&nbsp;${hs},&nbsp;chegando em ${d} às&nbsp;${hc}`;
        }

        return texto;
      }

      function textodavolta() {
        const volta_data = Byid("volta_data")?.value ?? "";
        const volta_num = Byid("volta_num")?.value ?? "";
        const volta_partida_aero = Byid("volta_partida_aero")?.value ?? "";
        const volta_partida_hora = Byid("volta_partida_hora")?.value ?? "";
        const volta_chegada_aero = Byid("volta_chegada_aero")?.value ?? "";
        const volta_chegada_hora = Byid("volta_chegada_hora")?.value ?? "";

        return (
          `E&nbsp;o voo de&nbsp;volta&nbsp;no dia&nbsp;${volta_data}, no voo G3&nbsp;${volta_num}, partindo de&nbsp;${volta_partida_aero} às ` +
          `${volta_partida_hora}, chegando em ${volta_chegada_aero} às ${volta_chegada_hora}`
        );
      }

      // Botão "Gerar Declaração"
      const btnGerar = Byid("btn_gerar");
      const preview = Byid("preview");

      if (btnGerar && preview) {
        btnGerar.addEventListener("click", (e) => {
          e.preventDefault();

          const tipo = Byid("tipo_viagem_select")?.value;
          let partes = [textoInicial(), textodaida()];
          if (tipo === "ida/volta") {
            partes.push(textodavolta());
          }

          // Usar innerHTML para respeitar &nbsp;
          preview.innerHTML = partes.filter(Boolean).join(". ") + ".";
        });
      }

      // Não gerar automaticamente: página inicia com valores padrões
    </script>
  </body>
</html>
