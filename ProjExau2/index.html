<!DOCTYPE html>
<html lang="pt-BR" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Controle Ventilador ESP8266</title>
  <link rel="stylesheet" href="app.css">
</head>
<body>
  <header class="appbar">
    <div class="container appbar-inner">
      <div class="logo" role="button" tabindex="0" title="Dashboard">
        <div class="mark" aria-hidden="true"></div>
        <div>Fan Control ESP8266</div>
        <span id="badgeSim" class="badge" style="display:none">SIMULA√á√ÉO</span>
      </div>

      <div class="spacer"></div>

      <div class="toolbar">
        <!-- Tema -->
        <div class="seg" role="tablist" aria-label="Tema">
          <button id="themeAuto" class="active" role="tab" aria-selected="true" title="Autom√°tico">Auto</button>
          <button id="themeLight" role="tab" aria-selected="false" title="Claro">Claro</button>
          <button id="themeDark"  role="tab" aria-selected="false" title="Escuro">Escuro</button>
        </div>

        <!-- Alerta geral -->
        <label class="switch" title="Alerta Geral">
          <input id="toggleAlertGlobal" type="checkbox" />
          <span class="track"><span class="knob"></span></span>
          <span>Alerta Geral</span>
        </label>

        <!-- Wi‚ÄëFi status -->
        <button id="btnWifiDiag" class="btn" title="Diagn√≥stico Wi‚ÄëFi">
          <span class="row">
            <span id="wifiDot" class="wifi-dot" aria-hidden="true"></span>
            <span id="wifiLabel">Wi‚ÄëFi</span>
          </span>
        </button>

        <!-- Configura√ß√µes -->
        <button id="btnSettings" class="btn" title="Configura√ß√µes">Configura√ß√µes ‚öôÔ∏è</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- KPIs -->
    <div class="card-grid">
      <div class="card metric">
        <div class="label">RPM</div>
        <div id="rpmVal" class="value">‚Äî</div>
        <div class="subtle">Rota√ß√£o por minuto</div>
      </div>
      <div class="card metric">
        <div class="label">Temperatura</div>
        <div id="tempVal" class="value">‚Äî</div>
        <div class="subtle">¬∞C</div>
      </div>
      <div class="card metric">
        <div class="label">Umidade</div>
        <div id="humVal" class="value">‚Äî</div>
        <div class="subtle">%</div>
      </div>
      <div class="card metric">
        <div class="label">PWM</div>
        <div id="pwmVal" class="value">‚Äî</div>
        <div class="subtle">Duty (%)</div>
      </div>
    </div>

    <div style="height:14px"></div>

    <!-- Controle -->
    <div class="card">
      <div class="row" style="justify-content: space-between">
        <div class="kpi">
          <div class="section-title">Controle do Ventilador</div>
          <span id="modeBadge" class="badge">Modo: <strong class="mono" id="modeText">‚Äî</strong></span>
          <span id="uptimeBadge" class="badge">Uptime: <span id="uptimeText" class="mono">‚Äî</span></span>
          <span id="alertBadge" class="badge">Alertas: <span id="alertState" class="mono">‚Äî</span></span>
        </div>
        <div class="controls">
          <button id="btnMode" class="btn primary">Modo: ‚Äî</button>
        </div>
      </div>
      <div class="divider"></div>
      <div class="grid-2">
        <div>
          <label for="pwmRange" class="label">PWM Manual</label>
          <input id="pwmRange" type="range" min="0" max="100" step="1" value="0" disabled />
          <div class="row">
            <div class="subtle">Ajuste dispon√≠vel apenas no modo Manual.</div>
            <div class="spacer"></div>
            <div><strong id="pwmRangeVal">0%</strong></div>
          </div>
        </div>
        <div>
          <div class="hint">Dica: no modo Autom√°tico o PWM √© calculado com base na temperatura (histerese/PID, conforme firmware).</div>
        </div>
      </div>
    </div>
  </main>

  <!-- Painel de Configura√ß√µes -->
  <div id="settingsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="drawer">
      <div class="tabs">
        <button class="btn" data-tab="tabWifi">üì∂ Wi‚ÄëFi</button>
        <button class="btn" data-tab="tabAlert">üö® Alerta</button>
        <button class="btn" data-tab="tabAdv">üß™ Avan√ßado</button>
        <button class="btn" data-tab="tabSys">üõ°Ô∏è Sistema</button>
        <div class="spacer"></div>
        <button id="btnCloseSettings" class="btn">Fechar ‚úñ</button>
      </div>
      <div class="drawer-body">
        <!-- Wi‚ÄëFi -->
        <section id="tabWifi" class="tab-panel">
          <div class="grid-2">
            <div class="card">
              <div class="section-title">Cliente (STA)</div>
              <div class="grid-2">
                <div class="field"><label>SSID</label><input id="staSsid" placeholder="Rede Wi‚ÄëFi" /></div>
                <div class="field"><label>Senha</label><input id="staPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" /></div>
              </div>
              <div class="row" style="margin-top:10px">
                <button id="btnSaveSTA" class="btn primary">Salvar & Testar</button>
                <button id="btnScan" class="btn">Scan Redes</button>
                <span id="wifiStaStatus" class="hint">‚Äî</span>
              </div>
              <div class="divider"></div>
              <div class="grid-3">
                <div class="field"><label>Estado</label><input id="wifiConnState" disabled value="‚Äî" /></div>
                <div class="field"><label>IP</label><input id="wifiIP" disabled value="‚Äî" /></div>
                <div class="field"><label>RSSI</label><input id="wifiRSSI" disabled value="‚Äî" /></div>
              </div>
              <div id="scanList" class="row" style="flex-wrap:wrap; gap:8px; margin-top:10px"></div>
            </div>

            <div class="card">
              <div class="section-title">Ponto de Acesso (AP)</div>
              <div class="grid-2">
                <div class="field"><label>SSID</label><input id="apSsid" placeholder="FAN-CTRL" /></div>
                <div class="field"><label>Senha (‚â• 8)</label><input id="apPass" type="password" placeholder="12345678" /></div>
              </div>
              <div class="row" style="margin-top:10px">
                <button id="btnSaveAP" class="btn primary">Salvar AP</button>
                <span id="wifiApStatus" class="hint">‚Äî</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Alerta -->
        <section id="tabAlert" class="tab-panel">
          <div class="grid-2">
            <div class="card">
              <div class="section-title">A√ß√µes para Alertas</div>
              <div class="grid-3">
                <div>
                  <div class="label">RPM</div>
                  <label class="switch"><input id="actRpmMsg" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Mensagem</span></label><br>
                  <label class="switch"><input id="actRpmBip" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Bip</span></label><br>
                  <label class="switch"><input id="actRpmLed" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>LED</span></label>
                </div>
                <div>
                  <div class="label">Temperatura</div>
                  <label class="switch"><input id="actTempMsg" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Mensagem</span></label><br>
                  <label class="switch"><input id="actTempBip" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Bip</span></label><br>
                  <label class="switch"><input id="actTempLed" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>LED</span></label>
                </div>
                <div>
                  <div class="label">Op√ß√µes</div>
                  <div class="field"><label>Repetir alerta a cada (ms)</label><input id="repeatMs" type="number" min="0" value="60000"></div>
                </div>
              </div>
              <div class="row" style="margin-top:10px">
                <button id="btnSaveActions" class="btn primary">Salvar A√ß√µes</button>
              </div>
            </div>

            <div class="card">
              <div class="section-title">Condi√ß√µes e Par√¢metros</div>
              <div class="grid-2">
                <div>
                  <div class="label">Flags RPM</div>
                  <label class="switch"><input id="flagRpmErr" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Erro de sensor</span></label><br>
                  <label class="switch"><input id="flagRpmRange" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Fora de par√¢metro</span></label>
                </div>
                <div>
                  <div class="label">Flags Temperatura</div>
                  <label class="switch"><input id="flagTempErr" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Erro de sensor</span></label><br>
                  <label class="switch"><input id="flagTempRange" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Fora de par√¢metro</span></label>
                </div>
              </div>
              <div class="grid-2" style="margin-top:10px">
                <div class="grid-2">
                  <div class="field"><label>RPM M√≠n</label><input id="rpmMin" type="number" value="300"></div>
                  <div class="field"><label>RPM M√°x</label><input id="rpmMax" type="number" value="3000"></div>
                </div>
                <div class="grid-2">
                  <div class="field"><label>Temp M√≠n (¬∞C)</label><input id="tMin" type="number" value="15"></div>
                  <div class="field"><label>Temp M√°x (¬∞C)</label><input id="tMax" type="number" value="65"></div>
                </div>
              </div>
              <div class="row" style="margin-top:10px">
                <button id="btnSaveFlags" class="btn">Salvar Flags</button>
                <button id="btnSaveParams" class="btn primary">Salvar Par√¢metros</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Avan√ßado (sem Telegram) -->
        <section id="tabAdv" class="tab-panel">
          <div class="grid-2">
            <div class="card">
              <div class="section-title">Modo Simula√ß√£o/Teste</div>
              <label class="switch"><input id="simEnable" type="checkbox"><span class="track"><span class="knob"></span></span><span>Ignorar sensores e usar valores fixos</span></label>
              <div class="grid-3" style="margin-top:10px">
                <div class="field"><label>RPM Fixo</label><input id="simRpm" type="number" value="1200"></div>
                <div class="field"><label>Temp Fixa (¬∞C)</label><input id="simTemp" type="number" step="0.1" value="35.0"></div>
                <div class="field"><label>Umidade Fixa (%)</label><input id="simHum" type="number" step="0.1" value="45.0"></div>
              </div>
              <div class="row" style="margin-top:10px">
                <button id="btnSaveSim" class="btn primary">Salvar Simula√ß√£o</button>
                <span class="hint">Mensagens externas podem ser suprimidas quando simula√ß√£o estiver ativa (depende do firmware).</span>
              </div>
            </div>

            <div class="card">
              <div class="section-title">Testar Alerta</div>
              <div class="row">
                <label class="switch"><input id="testBip" type="checkbox"><span class="track"><span class="knob"></span></span><span>Bip ON/OFF</span></label>
                <label class="switch"><input id="testLed" type="checkbox"><span class="track"><span class="knob"></span></span><span>LED ON/OFF</span></label>
              </div>

              <div class="divider"></div>

              <div class="section-title">Flags & Debug</div>
              <div class="grid-2">
                <div>
                  <label class="switch"><input id="fMonTempHumErr" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Monitorar Temperatura/Umidade e Erro de Sensor</span></label><br>
                  <label class="switch"><input id="fMonRpmErr" type="checkbox" checked><span class="track"><span class="knob"></span></span><span>Monitorar RPM e Erro de Sensor</span></label>
                </div>
                <div>
                  <label class="switch"><input id="fDebug" type="checkbox"><span class="track"><span class="knob"></span></span><span>Ativar modo Debug</span></label>
                </div>
              </div>
              <div class="row" style="margin-top:10px">
                <button id="btnSaveFlagsAdv" class="btn primary">Salvar Flags/Debug</button>
              </div>

              <div class="divider"></div>

              <div class="section-title">Log de Debug</div>
              <div class="row" style="gap:8px; margin-bottom:8px">
                <button id="btnViewLog" class="btn">Visualizar Log</button>
                <button id="btnSaveLog" class="btn">Salvar Log</button>
              </div>
              <pre id="logView" class="card mono" style="max-height:220px; overflow:auto; white-space:pre-wrap">‚Äî</pre>
            </div>
          </div>
        </section>

        <!-- Sistema -->
        <section id="tabSys" class="tab-panel">
          <div class="grid-2">
            <div class="card">
              <div class="section-title">Controle de Acesso</div>
              <div class="grid-2">
                <div class="field"><label>Usu√°rio</label><input id="sysUser" value="admin"></div>
                <div></div>
                <div class="field"><label>Senha antiga</label><input id="sysOld" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
                <div class="field"><label>Nova senha</label><input id="sysNew" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
                <div class="field"><label>Confirmar nova senha</label><input id="sysNew2" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
              </div>
              <div class="row" style="margin-top:10px">
                <button id="btnChangePass" class="btn primary">Alterar Senha</button>
              </div>
            </div>

            <div class="card">
              <div class="section-title">Mapeamento de Pinos</div>
              <div class="grid-2">
                <div class="field"><label>Sensor RPM</label><input id="pinRpm" type="number" value="14" /></div>
                <div class="field"><label>Temp/Umid (DHT/DS)</label><input id="pinDht" type="number" value="5" /></div>
                <div class="field"><label>PWM Ventilador</label><input id="pinPwm" type="number" value="12" /></div>
                <div class="field"><label>LED de Alerta</label><input id="pinLed" type="number" value="2" /></div>
                <div class="field"><label>Buzzer de Alerta</label><input id="pinBuz" type="number" value="4" /></div>
                <div class="field"><label>Bot√£o de Alerta</label><input id="pinBtn" type="number" value="0" /></div>
                <div class="field"><label>LED Wi‚ÄëFi</label><input id="pinWifiLed" type="number" value="16" /></div>
              </div>
              <div class="row" style="margin-top:10px">
                <button id="btnSavePins" class="btn primary">Salvar Pinos</button>
                <span class="hint">Evite GPIOs de boot ou sem interrup√ß√£o para RPM.</span>
              </div>

              <div class="divider"></div>

              <div class="danger-zone">
                <div class="section-title">Restaurar Configura√ß√£o Padr√£o</div>
                <div class="row">
                  <div class="field" style="min-width:220px"><label>Digite RESET para confirmar</label><input id="confirmReset" placeholder="RESET"></div>
                  <button id="btnReset" class="btn danger">Restaurar</button>
                </div>
                <div id="resetInfo" class="hint" style="margin-top:8px">O dispositivo ir√° reiniciar ap√≥s restaurar.</div>
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>
  </div>

  <div id="toasts" class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

  <script src="./app.js"></script>
</body>
</html>